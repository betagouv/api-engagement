version: 2

sources:
  - name: public
    description: Tables déjà présentes dans le schéma `public`.
    schema: public
    tables:
      - name: Partner
      - name: Mission
      - name: Widget
      - name: Campaign
  - name: analytics_raw
    description: Données brutes synchronisées depuis la base opérationnelle `analytics_raw`.
    schema: analytics_raw
    loader: node job export-to-analytics-raw
    tables:
      - name: StatEvent
        description: >-
          Événements de statistiques (impressions, clics, candidatures, création de compte) exportés depuis la base `core`
          pour alimenter l'entrepôt analytics. Chaque ligne correspond à une action utilisateur observée, enrichie des
          identifiants partenaires et missions.
        columns:
          - name: id
            description: Identifiant unique de l'événement issu de l'application source.
          - name: type
            description: Type d'événement (`click`, `print`, `apply`, `account`).
          - name: created_at
            description: Horodatage (UTC) de la collecte de l'événement.
          - name: updated_at
            description: Horodatage (UTC) de la mise à jour de l'événement.
          - name: click_id
            description: Identifiant d'un clic associé (si pertinent).
          - name: referer
            description: URL de provenance envoyée par le navigateur.
          - name: host
            description: Domaine sur lequel l'événement a été déclenché.
          - name: is_bot
            description: Indique si l'événement est classé comme bot (`true`) selon les règles de détection actuelles.
          - name: is_human
            description: Indique si l'événement est classé comme humain (`true`).
          - name: source
            description: Origine de la collecte (`api`, `widget`, `campaign`, `seo`, `jstag`, `publisher`).
          - name: source_id
            description: Identifiant métier associé à la source (id widget, campagne, etc.).
          - name: from_publisher_id
            description: Identifiant du partenaire diffuseur (source).
          - name: to_publisher_id
            description: Identifiant du partenaire receveur (annonceur).
          - name: mission_id
            description: Identifiant de la mission dans la base analytics (nullable).
          - name: mission_client_id
            description: Identifiant métier de la mission côté client/source (nullable).
          - name: tag
            description: Tag principal associé à l'événement (nullable).
          - name: tags
            description: Liste (array) de tags complémentaires (nullable).
          - name: status
            description: Statut métier de l'événement (ex. `PENDING`, `VALIDATED`, `CANCELED`).
          - name: custom_attributes
            description: Attributs personnalisés en JSON (nullable) fournis par la source.
      - name: moderation_event
        description: >-
          Historique des actions de modération issues de la base core. Chaque enregistrement trace l'état initial et
          final d'une mission après intervention d'un modérateur (automatique ou humain).
        columns:
          - name: id
            description: Identifiant unique de l'événement de modération côté analytics.
          - name: mission_id
            description: Identifiant de la mission concernée.
          - name: created_at
            description: Date de création de l'événement (UTC).
          - name: updated_at
            description: Dernière mise à jour (UTC), utilisée pour l'incrémentalité.
          - name: moderator_id
            description: Identifiant de l'utilisateur/modérateur à l'origine du changement.
          - name: user_name
            description: Nom libre stocké lors de l'action (ex. modération automatique).
          - name: initial_status
            description: Statut de la mission avant la modération.
          - name: new_status
            description: Statut de la mission après la modération.
          - name: initial_comment
            description: Commentaire initial (le cas échéant).
          - name: new_comment
            description: Nouveau commentaire appliqué.
          - name: initial_note
            description: Note initiale.
          - name: new_note
            description: Nouvelle note.
          - name: initial_title
            description: Ancien titre de mission connu avant modification.
          - name: new_title
            description: Nouveau titre de mission.
          - name: initial_siren
            description: Ancien numéro SIREN associé.
          - name: new_siren
            description: Nouveau numéro SIREN.
          - name: initial_rna
            description: Ancien identifiant RNA.
          - name: new_rna
            description: Nouvel identifiant RNA.

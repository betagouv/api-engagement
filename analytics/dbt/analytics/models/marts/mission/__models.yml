version: 2

models:
  - name: mission
    description: >
      Mart des missions construit à partir de `int_mission`. Il enrichit les identifiants bruts
      avec les libellés de domaine/activité, expose le statut, les attributs d'accessibilité
      et les curseurs temporels nécessaires pour les analyses incrémentales.
    columns:
      - name: id
        description: Identifiant unique de la mission.
        tests:
          - not_null
          - unique
      - name: publisher_id
        description: Identifiant du partenaire/publisher associé à la mission.
        tests:
          - relationships:
              arguments:
                to: ref('publisher')
                field: id
      - name: client_id
        description: Identifiant métier côté client/source.
      - name: domain
        description: Libellé du domaine (référentiel ou libellé original).
      - name: activity
        description: Libellé de l'activité (référentiel).
      - name: status
        description: Statut métier de la mission (alias de `status_code`).
      - name: tags
        description: Tags libres associés à la mission.
      - name: audience
        description: Publics ciblés par la mission.
      - name: reduced_mobility_accessible
        description: Accessibilité aux personnes à mobilité réduite.
      - name: open_to_minors
        description: Indique si la mission est ouverte aux mineurs.
      - name: close_to_transport
        description: Indique si la mission est proche des transports.
      - name: posted_at
        description: Date de publication initiale.
      - name: start_at
        description: Date de démarrage prévue.
      - name: end_at
        description: Date de fin prévue.
      - name: deleted_at
        description: Timestamp de suppression logique (nullable).
      - name: created_at
        description: Timestamp de création de la mission.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour de la mission.
        tests:
          - not_null
      - name: is_deleted
        description: Drapeau booléen dérivé de `deleted_at`.
      - name: organization_client_id
        description: Identifiant client de l'organisation côté diffuseur (nullable).
      - name: publisher_organization_id
        description: Identifiant de la relation partenaire/organisation (nullable).
      - name: publisher_organization_name
        description: Nom déclaré de l'organisation (nullable).
      - name: publisher_organization_url
        description: URL de référence de l'organisation (nullable).
      - name: publisher_organization_type
        description: Typologie déclarée de l'organisation (nullable).
      - name: publisher_organization_logo
        description: URL ou identifiant du logo (nullable).
      - name: publisher_organization_description
        description: Description libre de l'organisation (nullable).
      - name: publisher_organization_full_address
        description: Adresse complète déclarée (nullable).
      - name: publisher_organization_rna
        description: Identifiant RNA déclaré (nullable).
      - name: publisher_organization_siren
        description: Numéro SIREN déclaré (nullable).
      - name: publisher_organization_siret
        description: Numéro SIRET déclaré (nullable).
      - name: publisher_organization_department
        description: Département déclaré (libellé, nullable).
      - name: publisher_organization_department_code
        description: Code département déclaré (nullable).
      - name: publisher_organization_department_name
        description: Nom du département déclaré (nullable).
      - name: publisher_organization_post_code
        description: Code postal déclaré (nullable).
      - name: publisher_organization_city
        description: Ville déclarée (nullable).
      - name: publisher_organization_status_juridique
        description: Statut juridique déclaré (nullable).
      - name: publisher_organization_beneficiaries
        description: Liste des bénéficiaires déclarés (nullable).
      - name: publisher_organization_actions
        description: Liste des actions déclarées (nullable).
      - name: publisher_organization_reseaux
        description: Réseaux déclarés (nullable).
      - name: publisher_organization_name_verified
        description: Statut de vérification du nom (nullable).
      - name: publisher_organization_rna_verified
        description: Statut de vérification du RNA (nullable).
      - name: publisher_organization_siren_verified
        description: Statut de vérification du SIREN (nullable).
      - name: publisher_organization_siret_verified
        description: Statut de vérification du SIRET (nullable).
      - name: publisher_organization_address_verified
        description: Statut de vérification de l'adresse (nullable).
      - name: publisher_organization_city_verified
        description: Statut de vérification de la ville (nullable).
      - name: publisher_organization_postal_code_verified
        description: Statut de vérification du code postal (nullable).
      - name: publisher_organization_department_code_verified
        description: Statut de vérification du code département (nullable).
      - name: publisher_organization_department_name_verified
        description: Statut de vérification du nom de département (nullable).
      - name: publisher_organization_region_verified
        description: Statut de vérification de la région (nullable).
      - name: publisher_organization_verification_status
        description: Statut de vérification global (nullable).
      - name: publisher_organization_is_rup
        description: Indique si l'organisation est reconnue d'utilité publique (nullable).
      - name: publisher_organization_created_at
        description: Horodatage de création de la relation (nullable).
      - name: publisher_organization_updated_at
        description: Horodatage de dernière mise à jour de la relation (nullable).
  - name: mission_event
    description: >
      Mart des événements de missions. Chaque ligne reprend les informations de
      `stg_mission_event` et reclasse le champ `type` selon les règles du
      transformer historique (Created, Deleted, UpdatedStartDate, etc.) en se
      basant sur le contenu de `changes`.
    columns:
      - name: id
        description: Identifiant unique de l'événement.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant analytics de la mission concernée (Mission.id).
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: type
        description: >
          Catégorie fonctionnelle de l'événement (`Created`, `Deleted`,
          `UpdatedStartDate`, `UpdatedEndDate`, `UpdatedDescription`,
          `UpdatedActivityDomain`, `UpdatedPlaces`,
          `UpdatedJVAModerationStatus`, `UpdatedApiEngModerationStatus`,
          `UpdatedOther`).
        tests:
          - not_null
      - name: created_by
        description: Identifiant ou nom libre de l'auteur de l'événement.
      - name: created_at
        description: Date de création de l'événement.
        tests:
          - not_null
      - name: updated_at
        description: Date de dernière mise à jour (curseur incrémental).
        tests:
          - not_null
  - name: mission_moderation_status
    description: >
      Mart des statuts de modération par mission. Le modèle expose l'historique
      complet des statuts issus de `int_mission_moderation_status` pour les
      analyses et jointures dans les marts.
    columns:
      - name: id
        description: Identifiant unique du statut de modération.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant analytics de la mission concernée.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: publisher_id
        description: Identifiant du partenaire/publisher associé.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('publisher')
                field: id
      - name: moderation_status
        description: Statut de modération courant (enum texte).
      - name: moderation_comment
        description: Commentaire associé (nullable).
      - name: created_at
        description: Date de création du statut.
        tests:
          - not_null
      - name: updated_at
        description: Date de dernière mise à jour (curseur incrémental).
        tests:
          - not_null

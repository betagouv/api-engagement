version: 2

models:
  - name: mission
    description: >
      Mart des missions construit à partir de `int_mission`. Il enrichit les identifiants bruts
      avec les libellés de domaine/activité, expose le statut, les attributs d'accessibilité
      et les curseurs temporels nécessaires pour les analyses incrémentales.
    columns:
      - name: id
        description: Identifiant unique de la mission.
        tests:
          - not_null
          - unique
      - name: publisher_id
        description: Identifiant du partenaire/publisher associé à la mission.
        tests:
          - relationships:
              arguments:
                to: ref('publisher')
                field: id
      - name: client_id
        description: Identifiant métier côté client/source.
      - name: domain
        description: Libellé du domaine (référentiel ou libellé original).
      - name: activity
        description: Libellé de l'activité (référentiel).
      - name: status
        description: Statut métier de la mission (alias de `status_code`).
      - name: tags
        description: Tags libres associés à la mission.
      - name: audience
        description: Publics ciblés par la mission.
      - name: reduced_mobility_accessible
        description: Accessibilité aux personnes à mobilité réduite.
      - name: open_to_minors
        description: Indique si la mission est ouverte aux mineurs.
      - name: close_to_transport
        description: Indique si la mission est proche des transports.
      - name: posted_at
        description: Date de publication initiale.
      - name: start_at
        description: Date de démarrage prévue.
      - name: end_at
        description: Date de fin prévue.
      - name: deleted_at
        description: Timestamp de suppression logique (nullable).
      - name: created_at
        description: Timestamp de création de la mission.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour de la mission.
        tests:
          - not_null
      - name: is_deleted
        description: Drapeau booléen dérivé de `deleted_at`.
  - name: mission_event
    description: >
      Mart des événements de missions. Chaque ligne reprend les informations de
      `stg_mission_event` et reclasse le champ `type` selon les règles du
      transformer historique (Created, Deleted, UpdatedStartDate, etc.) en se
      basant sur le contenu de `changes`.
    columns:
      - name: id
        description: Identifiant unique de l'événement.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant analytics de la mission concernée (Mission.id).
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: type
        description: >
          Catégorie fonctionnelle de l'événement (`Created`, `Deleted`,
          `UpdatedStartDate`, `UpdatedEndDate`, `UpdatedDescription`,
          `UpdatedActivityDomain`, `UpdatedPlaces`,
          `UpdatedJVAModerationStatus`, `UpdatedApiEngModerationStatus`,
          `UpdatedOther`).
        tests:
          - not_null
      - name: created_by
        description: Identifiant ou nom libre de l'auteur de l'événement.
      - name: created_at
        description: Date de création de l'événement.
        tests:
          - not_null
      - name: updated_at
        description: Date de dernière mise à jour (curseur incrémental).
        tests:
          - not_null
  - name: mission_moderation_status
    description: >
      Mart des statuts de modération par mission. Le modèle expose l'historique
      complet des statuts issus de `int_mission_moderation_status` pour les
      analyses et jointures dans les marts.
    columns:
      - name: id
        description: Identifiant unique du statut de modération.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant analytics de la mission concernée.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: publisher_id
        description: Identifiant du partenaire/publisher associé.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('publisher')
                field: id
      - name: moderation_status
        description: Statut de modération courant (enum texte).
      - name: moderation_comment
        description: Commentaire associé (nullable).
      - name: created_at
        description: Date de création du statut.
        tests:
          - not_null
      - name: updated_at
        description: Date de dernière mise à jour (curseur incrémental).
        tests:
          - not_null

version: 2

models:
  - name: mart_account
    description: >
      Table analytique reproduisant la structure Prisma `Account`. Alimentée
      depuis `stg_stat_event__account`, elle normalise les identifiants mission,
      partenaires, source et clic afin de remplacer l’ancien job Node.
    columns:
      - name: id
        description: Identifiant UUID généré pour la table `Account`.
        tests:
          - not_null
          - unique
      - name: stat_event_id
        description: Identifiant historique de la création de compte (StatEvent).
        tests:
          - not_null
          - unique
      - name: mission_id
        description: UUID de la mission associée si retrouvée.
      - name: mission_id_raw
        description: Identifiant mission brut issu de StatEvent.
      - name: from_publisher_id
        description: UUID du partenaire diffuseur.
        tests:
          - not_null
      - name: to_publisher_id
        description: UUID du partenaire annonceur.
        tests:
          - not_null
      - name: click_id
        description: Référence vers la table `Click` lorsqu’un clic est associé.
      - name: view_id_raw
        description: Identifiant brut de la vue transmis par StatEvent.
      - name: source
        description: Origine normalisée (enum `SourceType`).

  - name: mart_apply
    description: >
      Table analytique des candidatures (équivalent Prisma `Apply`) construite
      depuis `stg_stat_event__apply`. On y retrouve les champs statut, mission,
      partenaires, source et attributs personnalisés.
    columns:
      - name: id
        description: Identifiant UUID généré pour la table `Apply`.
        tests:
          - not_null
          - unique
      - name: stat_event_id
        description: Identifiant StatEvent de la candidature (clé d’origine).
        tests:
          - not_null
          - unique
      - name: mission_id
        description: UUID de la mission associée.
      - name: mission_id_raw
        description: Identifiant mission brut provenant de StatEvent.
      - name: status
        description: Statut métier de la candidature.
      - name: from_publisher_id
        description: UUID du partenaire diffuseur.
        tests:
          - not_null
      - name: to_publisher_id
        description: UUID du partenaire annonceur.
        tests:
          - not_null
      - name: custom_attributes
        description: Champs JSON contenant les attributs personnalisés.
      - name: view_id_raw
        description: Identifiant brut de la vue lié à la candidature.

  - name: mart_click
    description: >
      Table analytique des clics reconstruite depuis `stg_stat_event__click`.
      Elle alimente la structure Prisma `Click` avec les lookups de missions,
      partenaires et sources.
    columns:
      - name: id
        description: Identifiant UUID du clic.
        tests:
          - not_null
          - unique
      - name: stat_event_id
        description: Identifiant StatEvent du clic (clé d’origine).
        tests:
          - not_null
          - unique
      - name: mission_id
        description: UUID de la mission associée si remontée.
      - name: mission_id_raw
        description: Identifiant mission brut remonté par StatEvent.
      - name: from_publisher_id
        description: UUID du partenaire diffuseur.
        tests:
          - not_null
      - name: to_publisher_id
        description: UUID du partenaire annonceur.
        tests:
          - not_null
      - name: source
        description: Origine normalisée du clic (`SourceType`).
      - name: is_bot
        description: Indicateur flagguant le clic comme bot.
      - name: is_human
        description: Indicateur flagguant le clic comme humain.

  - name: mart_impression
    description: >
      Table analytique des impressions (équivalent Prisma `Impression`) construite
      depuis `stg_stat_event__print`. Elle expose les identifiants mission, partenaires,
      sources et les timestamps requis.
    columns:
      - name: id
        description: Identifiant UUID de l’impression.
        tests:
          - not_null
          - unique
      - name: stat_event_id
        description: Identifiant StatEvent de l’impression.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: UUID de la mission associée (nullable).
      - name: mission_id_raw
        description: Identifiant mission brut provenant de StatEvent.
      - name: from_publisher_id
        description: UUID du partenaire diffuseur.
        tests:
          - not_null
      - name: to_publisher_id
        description: UUID du partenaire annonceur.
        tests:
          - not_null
      - name: source
        description: Origine normalisée de l’impression (`SourceType`).

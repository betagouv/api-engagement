version: 2

models:
  - name: stg_mission_event
    description: >
      Staging des événements métier liés aux missions provenant de la table
      `analytics_raw.mission_event`. Le modèle applique les conversions de types
      (timestamps, enums en texte) et relie chaque événement à la mission
      correspondante via l'ancien identifiant Mission.old_id.
    columns:
      - name: id
        description: Identifiant unique de l'événement.
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant analytics de la mission concernée (Mission.id).
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: type
        description: Type d'événement généré (`create`, `update`, `delete`).
        tests:
          - not_null
      - name: changes
        description: Détail JSON des changements appliqués à la mission.
      - name: created_by
        description: Identifiant ou nom libre de l'auteur de l'événement.
      - name: created_at
        description: Date de création de l'événement.
        tests:
          - not_null
      - name: updated_at
        description: Date de dernière mise à jour (curseur incrémental).
        tests:
          - not_null
  - name: stg_domain
    description: >
      Staging du référentiel des domaines de mission (`analytics_raw.domain`), avec typage
      des timestamps pour préparer les jointures et les filtres incrémentaux.
    columns:
      - name: id
        description: Identifiant unique du domaine.
        tests:
          - not_null
          - unique
      - name: name
        description: Libellé du domaine.
        tests:
          - not_null
      - name: created_at
        description: Timestamp de création.
      - name: updated_at
        description: Timestamp de dernière mise à jour.
        tests:
          - not_null
  - name: stg_mission_activity
    description: >
      Staging de la table de liaison mission ↔ activité (`analytics_raw.mission_activity`).
      Expose les couples mission_id / activity_id avec conversion du timestamp de création.
    columns:
      - name: mission_id
        description: Identifiant de la mission associée.
        tests:
          - not_null
      - name: activity_id
        description: Identifiant de l'activité associée.
        tests:
          - not_null
      - name: created_at
        description: Timestamp de création de la liaison.
  - name: stg_activity
    description: >
      Staging du référentiel des activités (`analytics_raw.activity`) avec conversions
      simples de types (timestamps).
    columns:
      - name: id
        description: Identifiant unique de l'activité.
        tests:
          - not_null
          - unique
      - name: name
        description: Libellé de l'activité.
        tests:
          - not_null
      - name: created_at
        description: Timestamp de création.
      - name: updated_at
        description: Timestamp de dernière mise à jour.
        tests:
          - not_null
  - name: stg_mission
    description: >
      Staging des missions exportées dans `analytics_raw.mission`. Le modèle applique les
      conversions de types (booléens, entiers, timestamps) et expose les principaux
      attributs métier (statut, rattachements, accessibilité, dates, tags...).
    columns:
      - name: id
        description: Identifiant unique de la mission (UUID).
        tests:
          - not_null
          - unique
      - name: client_id
        description: Identifiant métier de la mission côté client/source.
      - name: domain_id
        description: Référence au domaine (`analytics_raw.domain.id`).
      - name: activity_id
        description: Référence à l'activité (`analytics_raw.activity.id`).
      - name: publisher_id
        description: Partenaire/publisher propriétaire de la mission.
      - name: organization_id
        description: Organisation rattachée à la mission (nullable).
      - name: organization_client_id
        description: Identifiant client de l'organisation côté diffuseur (nullable).
      - name: status_code
        description: Statut métier de la mission dans la base source.
      - name: type
        description: Typologie de mission (benevolat, volontariat…).
      - name: tags
        description: Tags libres associés à la mission.
      - name: tasks
        description: Liste des tâches proposées.
      - name: audience
        description: Publics ciblés.
      - name: soft_skills
        description: Compétences comportementales attendues.
      - name: requirements
        description: Pré-requis complémentaires.
      - name: rome_skills
        description: Compétences codifiées (ROME).
      - name: reduced_mobility_accessible
        description: Accessibilité aux personnes à mobilité réduite.
      - name: close_to_transport
        description: Indique si la mission est proche des transports.
      - name: open_to_minors
        description: Indique si la mission est ouverte aux mineurs.
      - name: remote
        description: Modalités de télébénévolat (nullable).
      - name: schedule
        description: Informations de planning/rythme (nullable).
      - name: duration
        description: Durée estimée de la mission (nullable).
      - name: posted_at
        description: Date de publication initiale.
      - name: start_at
        description: Date de démarrage prévue.
      - name: end_at
        description: Date de fin prévue (nullable).
      - name: priority
        description: Niveau de priorité (nullable).
      - name: places
        description: Nombre de places ouvertes.
      - name: places_status
        description: Statut d'occupation des places (nullable).
      - name: domain_original
        description: Libellé de domaine initial remonté par la source externe (nullable).
      - name: deleted_at
        description: Timestamp de suppression logique (nullable).
      - name: created_at
        description: Timestamp de création.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour (curseur d'export).
        tests:
          - not_null
  - name: stg_mission_address
    description: >
      Staging des adresses associées aux missions, exportées depuis `analytics_raw.mission_address`. Le modèle applique
      les conversions de types nécessaires (timestamps, géoloc).
    columns:
      - name: id
        description: Identifiant unique de l'adresse (UUID).
        tests:
          - not_null
          - unique
      - name: mission_id
        description: Identifiant de la mission associée.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('mission')
                field: id
      - name: street
        description: Voie/adresse déclarée (nullable).
      - name: postal_code
        description: Code postal (nullable).
      - name: department_name
        description: Nom du département (nullable).
      - name: department_code
        description: Code du département (nullable).
      - name: city
        description: Ville déclarée (nullable).
      - name: region
        description: Région déclarée (nullable).
      - name: country
        description: Pays déclaré (nullable).
      - name: location_lat
        description: Latitude géographique (nullable).
      - name: location_lon
        description: Longitude géographique (nullable).
      - name: geo_point
        description: Point géographique (nullable).
      - name: geoloc_status
        description: Statut de géolocalisation (nullable).
      - name: created_at
        description: Timestamp de création de l'adresse.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour (curseur d'export).
        tests:
          - not_null

version: 2

models:
  - name: stg_publisher
    description: >
      Staging des partenaires exportés depuis `analytics_raw.publisher`. Ce modèle applique simplement les conversions
      de type nécessaires (timestamps, booléens) avant exposition aux marts.
    columns:
      - name: id
        description: Identifiant unique du partenaire (UUID de la table source).
        tests:
          - not_null
          - unique
      - name: name
        description: Nom du partenaire tel que saisi côté application.
      - name: is_annonceur
        description: Indique si le partenaire agit comme annonceur.
      - name: diffuseur_api
        description: Droit d'accès API sortant.
      - name: diffuseur_widget
        description: Droit d'accès aux widgets embarqués.
      - name: diffuseur_campaign
        description: Droit d'accès aux campagnes emailing.
      - name: created_at
        description: Timestamp de création initial.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour (curseur d'incrément).
        tests:
          - not_null
  - name: stg_publisher_organization
    description: >
      Staging des organisations rattachées aux partenaires, exportées depuis `analytics_raw.publisher_organization`.
      Le modèle normalise les types (timestamps, booléen) avant exposition aux couches supérieures.
    columns:
      - name: id
        description: Identifiant unique de la relation partenaire / organisation.
        tests:
          - not_null
          - unique
      - name: publisher_id
        description: Identifiant du partenaire diffuseur associé.
        tests:
          - not_null
      - name: organization_client_id
        description: Identifiant client de l'organisation côté diffuseur.
        tests:
          - not_null
      - name: organization_name
        description: Nom déclaré de l'organisation (nullable).
      - name: organization_rna
        description: Identifiant RNA déclaré (nullable).
      - name: organization_siren
        description: Numéro SIREN déclaré (nullable).
      - name: organization_siret
        description: Numéro SIRET déclaré (nullable).
      - name: organisation_is_rup
        description: Indique si l'organisation est reconnue d'utilité publique (nullable).
      - name: created_at
        description: Timestamp de création.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp de dernière mise à jour, utilisé pour l'incrémental.
        tests:
          - not_null
  - name: stg_publisher_diffusion_exclusion
    description: >
      Staging des exclusions de diffusion entre partenaires, exportées depuis `analytics_raw.publisher_diffusion_exclusion`.
      Chaque ligne décrit la relation annonceur/diffuseur et l'éventuelle organisation ciblée.
    columns:
      - name: id
        description: Identifiant unique de la règle d'exclusion.
        tests:
          - not_null
          - unique
      - name: excluded_by_annonceur_id
        description: Identifiant du partenaire annonceur à l'origine de l'exclusion.
        tests:
          - not_null
      - name: excluded_for_diffuseur_id
        description: Identifiant du partenaire diffuseur concerné.
        tests:
          - not_null
      - name: organization_client_id
        description: Identifiant client de l'organisation ciblée (nullable).
      - name: organization_name
        description: Libellé libre de l'organisation ciblée (nullable).
      - name: created_at
        description: Horodatage de création de la règle dans la base source.
        tests:
          - not_null
      - name: updated_at
        description: Horodatage de dernière mise à jour, utilisé comme curseur d'incrément.
        tests:
          - not_null

// analytics and core files are generated by prisma:generate
import { PrismaClient as PrismaClientAnalytics } from "./analytics";
import { PrismaClient as PrismaClientCore } from "./core";

const prismaCore = new PrismaClientCore({
  log: ["error"],
});
const prismaAnalytics = new PrismaClientAnalytics({
  log: ["error"],
});

const pgConnected = Promise.all(
  [
    { name: "Core", prisma: prismaCore },
    { name: "Analytics", prisma: prismaAnalytics },
  ].map(({ name, prisma }) => {
    return new Promise<void>((resolve, reject) => {
      prisma
        .$connect()
        .then(() => {
          console.log(`[PostgreSQL] ${name} connected`);
          resolve();
        })
        .catch((error) => {
          console.error(`[PostgreSQL] ${name} Connection error:`, error);
          reject(error);
        });
    });
  })
);

const pgDisconnect = async () => {
  await prismaCore.$disconnect();
  await prismaAnalytics.$disconnect();
};

export { pgConnected, pgDisconnect, prismaAnalytics, prismaCore };

// analytics and core files are generated by prisma:generate
import { PrismaClient as PrismaClientAnalytics } from "./analytics";
import { PrismaClient as PrismaClientCore } from "./core";

const prismaCore = new PrismaClientCore({
  log: ["error"],
});
const prismaAnalytics = new PrismaClientAnalytics({
  log: ["error"],
});

const connectPrisma = (name: string, prisma: { $connect: () => Promise<void> }) => {
  return prisma
    .$connect()
    .then(() => {
      console.log(`[PostgreSQL] ${name} connected`);
    })
    .catch((error) => {
      console.error(`[PostgreSQL] ${name} Connection error:`, error);
      throw error;
    });
};

const pgConnectedCore = () => connectPrisma("Core", prismaCore);
const pgConnectedAnalytics = () => connectPrisma("Analytics", prismaAnalytics);
const pgConnectedAll = () => Promise.all([pgConnectedCore(), pgConnectedAnalytics()]);

const pgDisconnect = async () => {
  await prismaCore.$disconnect();
  await prismaAnalytics.$disconnect();
};

export { pgConnectedAll, pgConnectedAnalytics, pgConnectedCore, pgDisconnect, prismaAnalytics, prismaCore };
